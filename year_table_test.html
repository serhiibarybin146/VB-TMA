<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таблица персональных дат</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #f4f7f9;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        h1 {
            text-align: center;
            color: #333;
            font-size: 1.2rem;
            text-transform: uppercase;
            margin-bottom: 20px;
        }

        .inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
        }

        input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            border: 2px solid #333;
        }

        th,
        td {
            border: 1px solid #333;
            padding: 5px;
            text-align: center;
        }

        th {
            background: #d0d0d0;
            font-weight: bold;
        }

        .month-header {
            background: #e0e0e0;
            font-weight: bold;
            text-align: left;
            min-width: 100px;
        }

        .empty-cell {
            background: #ccc;
        }

        td[contenteditable="true"]:hover {
            background: #fffde7;
            cursor: pointer;
        }

        td[contenteditable="true"]:focus {
            background: #fff9c4;
            outline: 2px solid #ffd600;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Таблица персональных дат</h1>

        <div class="inputs">
            <label>День рождения:</label>
            <input type="date" id="birthdate" value="1982-09-30">
            <button onclick="generateTable()">Сгенерировать</button>
        </div>

        <table id="datesTable">
            <thead>
                <tr id="headerRow">
                    <th rowspan="2">Месяц \ День</th>
                </tr>
                <tr id="dayNumberRow"></tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script>
        const monthNames = [
            "январь", "февраль", "март", "апрель", "май", "июнь",
            "июль", "август", "сентябрь", "октябрь", "ноябрь", "декабрь"
        ];

        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        function getPersonalYear(birthDay, birthMonth) {
            const today = new Date();
            const currentYear = today.getFullYear();
            const bdayThisYear = new Date(currentYear, birthMonth - 1, birthDay);
            return today >= bdayThisYear ? currentYear : currentYear - 1;
        }

        function generateTable() {
            const dateInput = document.getElementById('birthdate').value;
            if (!dateInput) return;

            const [y, m, d] = dateInput.split('-').map(Number);
            const startYear = y - 1;
            const startMonth = m;
            const startDay = d;

            const tableBody = document.getElementById('tableBody');
            const dayNumberRow = document.getElementById('dayNumberRow');

            tableBody.innerHTML = '';
            dayNumberRow.innerHTML = '';

            for (let i = 1; i <= 31; i++) {
                const th = document.createElement('th');
                th.textContent = i;
                dayNumberRow.appendChild(th);
            }

            // ВАРИАНТ 2: Личный ритм (честная математика)
            // Длины месяцев фиксированы: 31, 28/29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31

            function hasFeb29(start, end) {
                for (let y = start.getFullYear(); y <= end.getFullYear(); y++) {
                    const isLeap = (y % 4 === 0 && y % 100 !== 0) || (y % 400 === 0);
                    if (isLeap) {
                        const feb29 = new Date(y, 1, 29);
                        if (feb29 >= start && feb29 < end) return true;
                    }
                }
                return false;
            }

            const startDate = new Date(startYear, startMonth - 1, startDay);
            const endDate = new Date(startYear + 1, startMonth - 1, startDay);
            const isLeapInYear = hasFeb29(startDate, endDate);

            const monthLengths = [31, (isLeapInYear ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

            let dayPointer = new Date(startYear, startMonth - 1, startDay);

            for (let i = 0; i < 12; i++) {
                const tr = document.createElement('tr');

                const tdMonth = document.createElement('td');
                tdMonth.className = 'month-header';
                tdMonth.innerHTML = `ПМ ${String(i + 1).padStart(2, '0')}`;
                tr.appendChild(tdMonth);

                const currentMonthLen = monthLengths[i];

                for (let j = 1; j <= 31; j++) {
                    const td = document.createElement('td');
                    if (j <= currentMonthLen) {
                        const pad = n => String(n).padStart(2, '0');
                        td.textContent = `${pad(dayPointer.getDate())}.${pad(dayPointer.getMonth() + 1)}`;
                        td.contentEditable = "true";
                        dayPointer.setDate(dayPointer.getDate() + 1);
                    } else {
                        td.className = 'empty-cell';
                    }
                    tr.appendChild(td);
                }
                tableBody.appendChild(tr);
            }
        }

        // Initial load
        window.onload = generateTable;
    </script>

</body>

</html>